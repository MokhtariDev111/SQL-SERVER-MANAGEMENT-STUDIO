//////////////////////////////////////////////////////////////////////////////////////////////////////////////
CREATE TABLES 
INSERT DATA INTO TABLES 
LOG DETAILS
Explanation:
* **`U`** stands for **User table**.
* SQL Server checks if the object is a **user-defined table**.
* Other object types have different codes, for example:
without U 
SQL Server will return the ID for any object with that name (table, view, procedure, etc.).
  * `V` → View
  * `P` → Stored Procedure
  * `FN` → Scalar Function
  * `IF` → Inline Table Function
So `U` ensures that `OBJECT_ID` specifically looks for a **regular table**, not a view or procedure.

//////////////////////////////////////////////////////////////////////////////////////////////////////////////









--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--Project initialization : Create Database & Schemas
USE MASTER ;

CREATE DATABASE DataWarehouse;

USE DataWarehouse;

CREATE SCHEMA bronze;
GO
CREATE SCHEMA silver;
GO
CREATE SCHEMA gold;

----Project initialization : bronze layer  DDL ,naming convention

IF OBJECT_ID('bronze.crm_cust_info','U') IS NOT NULL
  DROP TABLE bronze.crm_cust_info;

GO 
CREATE TABLE bronze.crm_cust_info(
cst_id 			INT,
cst_key 		NVARCHAR(50),
cst_firstname 		NVARCHAR(50),
cst_lastname 		NVARCHAR(50),
cst_material_status 	NVARCHAR(50),
cst_gndr 		NVARCHAR(50),
cst_create_date 	DATE
);



IF OBJECT_ID('bronze.crm_prd_info', 'U') IS NOT NULL
    DROP TABLE bronze.crm_prd_info;
GO

CREATE TABLE bronze.crm_prd_info (
    prd_id       INT,
    prd_key      NVARCHAR(50),
    prd_nm       NVARCHAR(50),
    prd_cost     INT,
    prd_line     NVARCHAR(50),
    prd_start_dt DATETIME,
    prd_end_dt   DATETIME
);
GO

IF OBJECT_ID('bronze.crm_sales_details', 'U') IS NOT NULL
    DROP TABLE bronze.crm_sales_details;
GO

CREATE TABLE bronze.crm_sales_details (
    sls_ord_num  NVARCHAR(50),
    sls_prd_key  NVARCHAR(50),
    sls_cust_id  INT,
    sls_order_dt DATETIME,
    sls_ship_dt  DATETIME,
    sls_due_dt   DATETIME,
    sls_sales    INT,
    sls_quantity INT,
    sls_price    INT
);
GO

IF OBJECT_ID('bronze.erp_loc_a101', 'U') IS NOT NULL
    DROP TABLE bronze.erp_loc_a101;
GO

CREATE TABLE bronze.erp_loc_a101 (
    cid    NVARCHAR(50),
    cntry  NVARCHAR(50)
);
GO

IF OBJECT_ID('bronze.erp_cust_az12', 'U') IS NOT NULL
    DROP TABLE bronze.erp_cust_az12;
GO

CREATE TABLE bronze.erp_cust_az12 (
    cid    NVARCHAR(50),
    bdate  DATE,
    gen    NVARCHAR(50)
);
GO

IF OBJECT_ID('bronze.erp_px_cat_g1v2', 'U') IS NOT NULL
    DROP TABLE bronze.erp_px_cat_g1v2;
GO

CREATE TABLE bronze.erp_px_cat_g1v2 (
    id           NVARCHAR(50),
    cat          NVARCHAR(50),
    subcat       NVARCHAR(50),
    maintenance  NVARCHAR(50)
);
GO

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
//////////////////////////////////////////////////////////////////////////////////////////////////////////////
INSERT VALUES → single/multiple rows

INSERT SELECT → from another table/query

BULK INSERT → from file

OPENROWSET → file/remote source

MERGE → insert or update

SELECT INTO → create new table + insert
--
BULK INSERT table_name
FROM 'C:\file.csv'
WITH (FIELDTERMINATOR = ',', ROWTERMINATOR = '\n');

if u run it again u ll get duplicated data , solution , empty the table then load each time
--take care of the messaging
//////////////////////////////////////////////////////////////////////////////////////////////////////////////


--SQL LOAD SCRIPTS

CREATE OR ALTER PROCEDURE bronze.load_bronze AS
BEGIN
	DECLARE @start_time DATETIME, @end_time DATETIME,@batch_start_time DATETIME, @batch_end_time DATETIME;

	BEGIN TRY	
	SET @batch_start_time DATETIME;
	PRINT'================================================='
	PRINT'Loading the Bronze Layer'
	PRINT'================================================='
	PRINT 'Process started...';
        PRINT '';
	PRINT'-------------------------------------------------'
	PRINT 'Loading CRM Tables'
	PRINT'-------------------------------------------------'
	
	PRINT'----------------';
	SET @start_time=GETDATE(); 
	PRINT '>> Truncating Table: bronze.crm_cust_info';
	TRUNCATE TABLE bronze.crm_cust_info;

	PRINT '>> Inserting Data Into: bronze.crm_cust_info';
	bulk insert bronze.crm_cust_info
	FROM 'C:\Users\mokht\OneDrive\Bureau\FUTURE\SSMS\datasets\source_crm\cust_info.csv'
	WITH (
		FIRSTROW=2, -- skip the first row (headers)
		FIELDTERMINATOR=',',
		TABLOCK
	);--check with select
	SET @end_time=GETDATE(); 
	PRINT'>> Load Duration: '+ CAST(DATEDIFF(second,@start_time,@end_time) AS NVARCHAR) + 'seconds'; 
	PRINT'----------------';

	SET @start_time=GETDATE(); 
	PRINT '>> Truncating Table: bronze.crm_prd_info';
	TRUNCATE TABLE bronze.crm_prd_info;

	PRINT '>> Inserting Data Into: bronze.crm_prd_info';
	bulk insert bronze.crm_prd_info
	FROM 'C:\Users\mokht\OneDrive\Bureau\FUTURE\SSMS\datasets\source_crm\prd_info.csv'
	WITH (
		FIRSTROW=2, -- skip the first row (headers)
		FIELDTERMINATOR=',',
		TABLOCK
	);

	SET @end_time=GETDATE(); 
	PRINT'>> Load Duration: '+ CAST(DATEDIFF(second,@start_time,@end_time) AS NVARCHAR) + 'seconds'; 
	PRINT'----------------';

	
	SET @start_time=GETDATE(); 
	PRINT '>> Truncating Table: bronze.crm_sales_details';
	TRUNCATE TABLE bronze.crm_sales_details;

	PRINT '>> Inserting Data Into: bronze.crm_sales_details';
	bulk insert bronze.crm_sales_details
	FROM 'C:\Users\mokht\OneDrive\Bureau\FUTURE\SSMS\datasets\source_crm\sales_details.csv'
	WITH (
		FIRSTROW=2, -- skip the first row (headers)
		FIELDTERMINATOR=',',
		TABLOCK
	);
	SET @end_time=GETDATE(); 
	PRINT'>> Load Duration: '+ CAST(DATEDIFF(second,@start_time,@end_time) AS NVARCHAR) + 'seconds'; 
	PRINT'----------------';

	PRINT'-------------------------------------------------'
	PRINT 'Loading ERP Tables'
	PRINT'-------------------------------------------------'

	SET @start_time=GETDATE(); 
	PRINT '>> Truncating Table: bronze.erp_loc_a101';
	TRUNCATE TABLE bronze.erp_loc_a101;

	PRINT '>> Inserting Data Into: bronze.erp_loc_a101';
	bulk insert bronze.erp_loc_a101
	FROM 'C:\Users\mokht\OneDrive\Bureau\FUTURE\SSMS\datasets\source_erp\LOC_A101.csv'
	WITH (
		FIRSTROW=2, -- skip the first row (headers)
		FIELDTERMINATOR=',',
		TABLOCK
	);
	SET @end_time=GETDATE(); 
	PRINT'>> Load Duration: '+ CAST(DATEDIFF(second,@start_time,@end_time) AS NVARCHAR) + 'seconds'; 
	PRINT'----------------';

	SET @start_time=GETDATE(); 
	PRINT '>> Truncating Table: bronze.erp_cust_az12';
	TRUNCATE TABLE bronze.erp_cust_az12;
	
	PRINT '>> Inserting Data Into: bronze.erp_cust_az12';
	bulk insert bronze.erp_cust_az12
	FROM C:\Users\mokht\OneDrive\Bureau\FUTURE\SSMS\datasets\source_erp\CUST_AZ12.csv'
	WITH (
		FIRSTROW=2, -- skip the first row (headers)
		FIELDTERMINATOR=',',
		TABLOCK
	);
	SET @end_time=GETDATE(); 
	PRINT'>> Load Duration: '+ CAST(DATEDIFF(second,@start_time,@end_time) AS NVARCHAR) + 'seconds'; 
	PRINT'----------------';

	SET @start_time=GETDATE(); 
	PRINT '>> Truncating Table: bronze.erp_px_cat_g1v2';
	TRUNCATE TABLE bronze.erp_px_cat_g1v2;

	PRINT '>> Inserting Data Into: bronze.erp_px_cat_g1v2';
	bulk insert bronze.erp_px_cat_g1v2
	FROM 'C:\Users\mokht\OneDrive\Bureau\FUTURE\SSMS\datasets\source_erp\PX_CAT_G1V2.csv'
	WITH (
		FIRSTROW=2, -- skip the first row (headers)
		FIELDTERMINATOR=',',
		TABLOCK
	);
	SET @end_time=GETDATE(); 
	PRINT'>> Load Duration: '+ CAST(DATEDIFF(second,@start_time,@end_time) AS NVARCHAR) + 'seconds'; 
	PRINT'----------------';


	SET @batch_end_time =GETDATE();
	PRINT'==============================================='
	PRINT'Loading Bronze Layer is Completed';
	PRINT'   -Total Load Duration: ' + CAST(DATEDIFF(SECOND,@batch_start_time,@batch_end_time) AS NVARCHAR) +'seconds'
	PRINT'==============================================='
	END TRY 
	BEGIN CATCH
		PRINT'==============================================='
		PRINT 'ERROR OCCURED DURING LOADING BRONZE LAYER'
		PRINT 'Error Message' + ERROR_MESSAGE();
		PRINT 'Error Message' + CAST(ERROR_NUMBER() AS NVARCHAR);
		PRINT 'Error Message' + CAST(ERROR_STATE() AS NVARCHAR);
		PRINT'==============================================='
	END CATCH
END

EXEC bronze.load_bronze;
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------












































